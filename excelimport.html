<title>处理商城数据</title>

<link rel="stylesheet" href="css/dropzone.css" />
<link rel="stylesheet" href="css/ui.jqgrid.css"/>
<link rel="stylesheet" href="css/jquery.gritter.css" />
<link rel="stylesheet" href="css/chosen.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nestable2/1.6.0/jquery.nestable.min.css" />

<script src="js/basic.js"></script>
<script src="js/jqGrid/jquery.jqGrid.min.js"></script>
<script src="js/ace-elements.min.js"/>
<!--<script src="js/chosen.jquery.min.js"></script>-->


<!--<script src="js/jq-table.js"/>-->
<script type="text/javascript">
    toastr.options.positionClass = 'toast-top-center';

</script>
<!-- ajax layout which only needs content area -->
<!--<div class="page-header">
    <h1>
        Data-transform
        <small>
            <i class="ace-icon fa fa-angle-double-right"></i>
            Drag &amp; drop file upload with image preview
        </small>
    </h1>
</div>-->
<!-- /.page-header -->

<div class="row">
    <div class="col-xs-12">
        <!-- PAGE CONTENT BEGINS -->
        <!-- #section:elements.accordion -->
        <div id="accordion" class="accordion-style1 panel-group">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" id="accordionOne" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                            <i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
                            &nbsp;导入数据 #1
                        </a>
                    </h4>
                </div>

                <div class="panel-collapse collapse in" id="collapseOne">
                    <div class="panel-body">
                        <form action="#" class="dropzone" id="dropzone">
                            <button id="exlmodel" type='button' class='btn btn-default btn-sm'>模板下载</button>
                            <div class="fallback">
                                <input name="file" type="file" multiple="" />
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a class="accordion-toggle collapsed" id="accordionMatch" data-toggle="collapse" data-parent="#accordion" href="#collapseMatch">
                            <i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
                            &nbsp;数据确认 #2
                        </a>
                    </h4>
                </div>

                <div class="panel-collapse collapse" id="collapseMatch">
                    <div class="panel-body">

                    <div class="col-xs-3 col-sm-3 pricing-span-header">
                        <div class="widget-box transparent">
                            <div class="widget-header">
                                <h5 class="widget-title bigger lighter">订单号</h5>
                            </div>

                            <div class="widget-body">
                                <div class="widget-main no-padding">
                                    <ul id="titles" class="list-unstyled list-striped pricing-table-header">
                                        <li></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- #section:pages/pricing.small-body -->
                    <div class="col-xs-8 col-sm-9 pricing-span-body">
                        <div class="pricing-span" style="width: 16%">
                            <div class="widget-box pricing-box-small widget-color-red3">
                                <div class="widget-header">
                                    <h5 class="widget-title bigger lighter">SKU</h5>
                                </div>

                                <div class="widget-body">
                                    <div class="widget-main no-padding">
                                        <ul id="skus" class="list-unstyled list-striped pricing-table">
                                            <li></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="pricing-span" style="width: 21%">
                            <div class="widget-box pricing-box-small widget-color-orange">
                                <div class="widget-header">
                                    <h5 class="widget-title bigger lighter">NAME</h5>
                                </div>

                                <div class="widget-body">
                                    <div class="widget-main no-padding">
                                        <ul id="names" class="list-unstyled list-striped pricing-table">
                                            <li></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="pricing-span" style="width: 16%">
                            <div class="widget-box pricing-box-small widget-color-blue">
                                <div class="widget-header">
                                    <h5 class="widget-title bigger lighter">New SKU</h5>
                                </div>

                                <div class="widget-body">
                                    <div class="widget-main no-padding">
                                        <ul id="newSkus" class="list-unstyled list-striped pricing-table">
                                            <li></li>
                                        </ul>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="pricing-span" style="width: 21%">
                            <div class="widget-box pricing-box-small widget-color-green">
                                <div class="widget-header">
                                    <h5 class="widget-title bigger lighter">英文名称</h5>
                                </div>

                                <div class="widget-body">
                                    <div class="widget-main no-padding">
                                        <ul id="newNames" class="list-unstyled list-striped pricing-table">
                                            <li></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="pricing-span" style="width: 19%">
                            <div class="widget-box pricing-box-small widget-color-grey">
                                <div class="widget-header">
                                    <h5 class="widget-title bigger lighter">中文名称</h5>
                                </div>

                                <div class="widget-body">
                                    <div class="widget-main no-padding">
                                        <ul id="newCnNames" class="list-unstyled list-striped pricing-table">
                                            <li></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="width: 5%; float: left!important;">
                            <div class="widget-box pricing-box-small widget-color-pink">
                                <div class="widget-header">
                                    <h5 class="widget-title bigger lighter"></h5>
                                </div>

                                <div class="widget-body">
                                    <div class="widget-main no-padding">
                                        <ul id="options" class="list-unstyled list-striped pricing-table">
                                            <li></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- /section:pages/pricing.small-body -->
                    <div class="pull-right" style="margin-right: 35px;">
                        <button id="matchBtn" class="btn btn-primary">
                            <i class="ace-icon fa fa-flask align-top bigger-125"></i>
                            匹配
                        </button>

                        <button id="confirmBtn" class="btn btn-success">
                            <i class="ace-icon fa fa-check"></i>
                            确定
                        </button>
                    </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a class="accordion-toggle collapsed" id="accordionTable" data-toggle="collapse" data-parent="#accordion" href="#collapseTable">
                            <i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
                            &nbsp;数据处理 #3
                        </a>
                    </h4>
                </div>

                <div class="panel-collapse collapse" id="collapseTable">
                    <!--<div class="panel-body">-->
                    <table id="grid-table"></table>

                    <div id="grid-pager"></div>
                    <!--</div>-->
                </div>
            </div>
            <!-- /section:elements.accordion -->

            <!-- 模态框（Modal）modal-sm -->
            <div class="modal fade bs-example-modal-sm" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog ">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                &times;
                            </button>
                            <h4 class="modal-title" id="myModalLabel">
                            </h4>
                        </div>
                        <div class="modal-body">
                            <div class="dd" id="nestable">
                                <ol id="menulist" class="dd-list">
                                    <li class="dd-item" data-id="1">
                                        <div class="dd-handle">Item 1</div>
                                    </li>
                                </ol>
                            </div>

                            <div class="row" >

                            </div>
                        </div>
                        <div class="modal-footer">

                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal -->
            </div>

            <!-- 模态框（Modal）modal-sm -->
            <div class="modal fade bs-example-modal-sm" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
                <div class="modal-dialog ">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                &times;
                            </button>
                            <h4 class="modal-title" id="editModalLabel">
                                修改信息
                            </h4>
                        </div>
                        <div class="modal-body">
                            <form class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label no-padding-right" for="formSku"> SKU </label>

                                    <div class="col-sm-9">
                                        <input type="text" id="formSku" placeholder="SKU" class="col-xs-10 col-sm-5" readonly/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label no-padding-right" for="formName"> Name </label>

                                    <div class="col-sm-9">
                                        <input type="text" id="formName" placeholder="Name" class="col-xs-10" readonly/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label no-padding-right" for="selectName"> Name </label>

                                    <div class="col-sm-9">
                                        <select class="chosen-select" id="selectName" data-placeholder="Choose a Name...">
                                            <option value=""></option>
                                        </select>
                                    </div>
                                </div>
                                <input id="selectnum" hidden/>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">关闭</button>
                            <button onclick="updateInfo()" type="button" class="btn btn-success btn-sm">确认</button>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal -->
            </div>
        </div>
            <!-- PAGE CONTENT ENDS -->
    </div><!-- /.col -->
</div><!-- /.row -->


<!-- inline scripts related to this page -->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.js"/>-->
<!--<script src="js/dropzone.min.js"/>-->

<script src="js/xlsx.js"/>
<script src="js/jq-table.js"/>

<script type="text/javascript">

    var dateObj = new Date();
    var year = dateObj.getFullYear();
    var month = dateObj.getMonth()+1;//月  (注意：月份+1)
    var date = dateObj.getDate();//日

    var scripts = ["js/exlimport.js",
        "js/chosen.jquery.min.js",
        "js/jqGrid/i18n/grid.locale-en.js",
        "js/jquery.gritter.min.js",
        "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.3/xlsx.full.min.js",
//        "https://cdnjs.cloudflare.com/ajax/libs/Nestable/2012-10-15/jquery.nestable.min.js",
//        "https://cdnjs.cloudflare.com/ajax/libs/nestable2/1.6.0/jquery.nestable.min.js",
        "https://cdn.jsdelivr.net/npm/nestable2@1.6.0/jquery.nestable.min.js",
        "https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.js",
        "https://cdnjs.cloudflare.com/ajax/libs/jquery.gridster/0.5.6/jquery.gridster.min.js"]

    ace.load_ajax_scripts(scripts, function() {
        //inline scripts related to this page
        jQuery(function($){
//            toastr.options.positionClass = 'toast-top-center';
            init_data();
//            init();

            Dropzone.autoDiscover = false;
            try {
                var myDropzone = new Dropzone("#dropzone" , {
                    paramName: "file", // The name that will be used to transfer the file
                    maxFilesize: 5, // MB
                    maxFiles:1,
                    acceptedFiles:".xlsx",
                    addRemoveLinks : true,
                    dictDefaultMessage :
                        '<span class="bigger-150 bolder"><i class="ace-icon fa fa-caret-right red"></i> Drop files</span> to upload \
                        <span class="smaller-80 grey">(or click)</span> <br /> \
                        <i class="upload-icon ace-icon fa fa-cloud-upload blue fa-3x"></i>'
                    ,
                    dictResponseError: 'Error while uploading file!',

                    //change the previewTemplate to use Bootstrap progress bars
                    previewTemplate: "<div class=\"dz-preview dz-file-preview\">\n  <div class=\"dz-details\">\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\n    <div class=\"dz-size\" data-dz-size></div>\n    <img data-dz-thumbnail />\n  </div>\n  <div class=\"progress progress-small progress-striped active\"><div class=\"progress-bar progress-bar-success\" data-dz-uploadprogress></div></div>\n  <div class=\"dz-success-mark\"><span></span></div>\n  <div class=\"dz-error-mark\"><span></span></div>\n  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n</div>"
                });

                myDropzone.on("addedfile", function(file) {
                    /* Maybe display some more file information on your page */
                    if(this.files.length > 0 ){
                        for(let i = 0; i < this.files.length; i++) {
                            let f = this.files[i];
                            if(f.status == 'error')
                                return;
                        }

                        import_data(myDropzone);
                    }
                });

                myDropzone.on("removedfile",function (file) {
                });
            } catch(e) {
                alert('Dropzone.js does not support older browsers!');
                console.info("Dropzone init Error")
            }

            console.info("Dropzone init End");

            $('.dd').nestable({ "maxDepth":2 });

            $('.dd-handle a').on('mousedown', function(e){
                e.stopPropagation();
            });

            $('.dd').on('change', function() {
                nestableChange();
            });
            $('[data-rel="tooltip"]').tooltip();

            $("#grid-pager_left").css("width", "auto");

            $('.chosen-select').chosen({allow_single_deselect:true});

            $('#editModal').find('.chosen-container').each(function(){
                $(this).find('a:first-child').css('width' , '310px');
                $(this).find('.chosen-drop').css('width' , '310px');
                $(this).find('.chosen-search input').css('width' , '300px');
            });

            $(window)
                .off('resize.chosen')
                .on('resize.chosen', function() {
                    $('.chosen-select').each(function() {
                        var $this = $(this);
                        $this.next().css({'width': $this.parent().width()});
                    })
                }).trigger('resize.chosen');

        });
    });
</script>